<script>
  (async function () {
    const partnerId = "{{settings.partnerId}}";
    const apiKey = "{{settings.apiKey}}";

    if (!partnerId || !apiKey) {
      console.error(
        "Warning: No Partner ID/API Key is defined. Please configure it in the apps admin."
      )
      return
    }
    const creds = JSON.stringify({"zrlKey": partnerId, "zrlValue": apiKey})
    sessionStorage.setItem("_zrlsession", creds)

    // const s = document.createElement("script");
    // s.type = "text/javascript";
    // s.async = true;
    // s.id = "zinreloscript"
    // s.src = "https://cdn.zinrelo.com/js/all.js";
    // s.onload = async function () {
    //   // setTimeout(() => {console.log("afaf")}, 5000)
    //   const userData = JSON.parse(sessionStorage.getItem("userData"))
    //   console.log("userData", userData)

    //   const uID = userData !== null && userData.isAuthenticated ? userData.id : ""
    //   const clientEmail = userData !== null && userData.isAuthenticated ? userData.email : ""
    //   const clientNameFull = userData !== null && userData.isAuthenticated ? userData.firstName + '' +userData.lastName : ""
    //   const currentTime = Date.now();
    //   const fullString = uID + clientEmail + partnerId + apiKey + currentTime;

    //   const msgBuffer = new TextEncoder().encode(fullString);
    //   const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
    //   const hashArray = Array.from(new Uint8Array(hashBuffer));
    //   const hashHex = hashArray
    //     .map((b) => b.toString(16).padStart(2, "0"))
    //     .join("");
    //   window._zrl = window._zrl || [];
    //   var init_data = {
    //     partner_id: partnerId,
    //     email: clientEmail,
    //     name: clientNameFull,
    //     user_id: uID,
    //     ts: currentTime,
    //     access_token: hashHex,
    //   };
    //   _zrl.push(["init", init_data]);
    // };

    // var x = document.getElementsByTagName("script")[0];
    // x.parentNode.insertBefore(s, x);

  })();
</script>
